- name: Commit & push updated output
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"
          
          # Set the date to IST so the filename matches your local morning
          FILE_DATE=$(TZ='Asia/Kolkata' date +'%Y-%m-%d')
          
          mkdir -p site/data/archive
          
          if [ -f "site/data/daily_brief.json" ]; then
            cp site/data/daily_brief.json site/data/archive/brief_$FILE_DATE.json
          fi
          
          ls site/data/archive | sed 's/brief_//;s/.json//' | jq -R . | jq -s . > site/data/manifest.json

          git add -f data/*.json site/data/*.json site/data/archive/*.json
          
          git stash
          git pull origin main --rebase
          git stash pop || echo "No stashed changes to apply"

          if [ -n "$(git status --porcelain)" ]; then
            git commit -m "ðŸ¤– Auto-update: Brief for $FILE_DATE [skip ci]"
            git push origin main
          else
            echo "No changes detected."
          fi